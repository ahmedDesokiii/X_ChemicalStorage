@model LotViewModel

@{
    var canExchange = AuthorizationService
        .AuthorizeAsync(User, Permissions.Lots.Exchange_Lots)
        .Result.Succeeded;
}

<div class="modal fade" id="ListItemsModalDis" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content card card-success card-outline">

            <!-- Header -->
            <div class="modal-header modal-header-custom">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-box-seam me-2"></i>
                    Items List
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <!-- Body -->
            <div class="modal-body">
                <div class="mb-3">
                    <input type="text"
                           id="itemsSearchInput"
                           class="form-control"
                           placeholder="Scan barcode..."
                           autocomplete="off" />
                    <small id="scanMessage" class="text-danger d-none mt-1">
                        Item not found
                    </small>
                </div>
                @if (!Model.ItemsList.Any())
                {
                    <div class="alert alert-warning mt-4 text-center">
                        <h5>No Items</h5>
                        <p class="mb-0">No items have been added yet.</p>
                    </div>
                }
                else
                {
                    <div class="items-grid">

                        @foreach (var item in Model.ItemsList)
                        {
                            <div class="item-card"
                                 data-name="@item.Name"
                                 data-code="@item.Code"
                                 data-barcode="@item.Code"
                                 data-category="@item.Category?.Name">



                                <!-- Header -->
                                <div class="item-card-header">
                                    <div class="item-name">@item.Name</div>
                                    <img src="@item.BarcodeImage" class="barcode-mobile" />
                                </div>

                                <!-- Meta -->
                                <div class="item-meta">
                                    <div><strong>Code:</strong> @item.Code</div>
                                    <div><strong>Category:</strong> @item.Category?.Name</div>
                                </div>

                                <!-- Storage -->
                                @{
                                    var badgeClass = item.StorageCondition switch
                                    {
                                        "room temp" => "badge-room",
                                        "2-8C" => "badge-cold",
                                        _ => "badge-other"
                                    };
                                }

                                <span class="storage-badge @badgeClass">
                                    <i class="bi bi-thermometer-half"></i>
                                    @item.StorageCondition
                                </span>

                                <!-- Actions -->
                                @if (canExchange)
                                {
                                    <div class="item-actions">
                                        <a asp-controller="Items"
                                           asp-action="ExchangeLot"
                                           asp-route-id="@item.Id"
                                           class="btn action-btn"
                                           title="Exchange Lot">
                                            <i class="bi bi-cart-dash-fill fs-1"></i>
                                        </a>
                                    </div>
                                }
                            </div>
                        }

                    </div>

                }

            </div>
        </div>
    </div>
</div>
